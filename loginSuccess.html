<!DOCTYPE html>
<html lang="en">

<head>
    <title>MineShroom</title>
    <meta name="description" content="DApp Game">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="loginSuccess.css">
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.37/dist/web3.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.6/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyBTYgsJ6zlA_F7MLqo93pCG-BCKjdUSXL8",
            authDomain: "test-f0398.firebaseapp.com",
            databaseURL: "https://test-f0398.firebaseio.com",
            projectId: "test-f0398",
            storageBucket: "test-f0398.appspot.com",
            messagingSenderId: "1052724752382"
        };
        firebase.initializeApp(config);
    </script>
    <script src="https://www.gstatic.com/firebasejs/5.8.6/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyBTYgsJ6zlA_F7MLqo93pCG-BCKjdUSXL8",
            authDomain: "test-f0398.firebaseapp.com",
            databaseURL: "https://test-f0398.firebaseio.com",
            projectId: "test-f0398",
            storageBucket: "test-f0398.appspot.com",
            messagingSenderId: "1052724752382"
        };
        firebase.initializeApp(config);
    </script>
</head>

<body>
    <div class="fixedHeader">
        <div class="fixed_logo">
            <img src="image/logo.png" alt="logo of MineShroom" />
        </div>
        <div class="fixedLogoText">
            <img src="image/cryptoMushroomLogo.png" alt="text of MineShroom" />
        </div>
        <div class="fixed_amount">
            <div class="eth">
            </div>
            <div class="Mushroom_balance">
            </div>
        </div>
    </div>
    <div class="container">


        <header>
            <!-- phone only -->
            <div id="mySidenav" class="sidenav">
                <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
                <a href="index.html">Home</a>
                <a href="shroomMall.html">ShroomMall</a>
                <a href="MushroomCoin.html">MushroomCoin</a>
                <a href="FAQ.html">FAQ</a>
            </div>
            <main>
                <div class="card">
                    <div class="card-header">
                        <div class="card_logo" onclick="openNav()">
                            <img src="image/logo.png" alt="logo of MineShroom" />
                        </div>
                        <nav class="main-nav">
                            <ul>
                                <li class="Home"><a href="index.html">Home</a></li>
                                <li class="ShroomMall"><a href="shroomMall.html">ShroomMall</a></li>
                                <li class="MushroomCoin"><a href="MushroomCoin.html">MushroomCoin</a></li>
                                <li class="FAQ"><a href="FAQ.html">FAQ</a></li>
                            </ul>
                        </nav>
                    </div>
                    <div class="loadingIMG" id="loadimg">
                        <img src="image/waiting.png">
                    </div>
                    <div class="content">

                        <div class="img_circle">
                            <div class="prof_face">
                                <img src="image/profile_face.png" />
                            </div>
                        </div>
                        <div class="info_text">
                            <div id="ply"></div>
                            <div class="playsec">
                                <div class="playerImg"><img src="image/ETH.png"> </div>
                                <div id="DXNcoin"></div>
                                <button class="info_but">Withdraw / Deposit</button>
                            </div>
                            <div class="playsec">
                                <div class="playerImg"> <img src="image/coin.png"></div>
                                <div id="Gucoin"></div>
                                <button class="info_but" id="buyGu">Buy More</button>
                            </div>
                            <div class="start_container">
                                <div class="start_be">Banker
                                    <div> <input type="text" maxlength="10" placeholder="At least 100 USD" value="">
                                    </div>
                                    <button id="bankerStart">START</button>
                                </div>
                                <div class="start_be">Player
                                    <button id="playerStart">START</button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="log_container">
                </div>
    </div>
    <footer>
        <div class="footer-wrapper">
            <div class="footer-nav-links">
                <nav class="footer-nav">
                    <a href="#"><img scr=""></a>
                    <a href="#"><img src=""></a>
                    <a href="#"><img src=""></a>
                    <a href="#"><img src=""></a>
                </nav>
            </div>
        </div>
    </footer>
    </main>
    </div>
</body>
<script>
    abi = [{
            "constant": true,
            "inputs": [{
                "name": "_user",
                "type": "address"
            }],
            "name": "getGuCoin",
            "outputs": [{
                "name": "",
                "type": "uint256"
            }],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": true,
            "inputs": [{
                "name": "_addr",
                "type": "address"
            }],
            "name": "isRegister",
            "outputs": [{
                "name": "",
                "type": "bool"
            }],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": true,
            "inputs": [],
            "name": "mushroom_eth_rate",
            "outputs": [{
                "name": "",
                "type": "uint256"
            }],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": false,
            "inputs": [],
            "name": "buyGuCoin",
            "outputs": [],
            "payable": true,
            "stateMutability": "payable",
            "type": "function"
        },
        {
            "constant": true,
            "inputs": [{
                "name": "game_index",
                "type": "uint256"
            }],
            "name": "getGameInfo",
            "outputs": [{
                    "name": "",
                    "type": "string"
                },
                {
                    "name": "",
                    "type": "address[]"
                },
                {
                    "name": "",
                    "type": "uint256"
                },
                {
                    "name": "",
                    "type": "uint256"
                },
                {
                    "name": "",
                    "type": "uint256"
                },
                {
                    "name": "",
                    "type": "uint8"
                }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": false,
            "inputs": [],
            "name": "registerUser",
            "outputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "constant": false,
            "inputs": [],
            "name": "newGame",
            "outputs": [{
                "name": "",
                "type": "uint256"
            }],
            "payable": true,
            "stateMutability": "payable",
            "type": "function"
        },
        {
            "constant": true,
            "inputs": [{
                "name": "_addr",
                "type": "address"
            }],
            "name": "getBankerGame",
            "outputs": [{
                    "name": "",
                    "type": "bool"
                },
                {
                    "name": "",
                    "type": "uint256"
                }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": true,
            "inputs": [{
                    "name": "game_index",
                    "type": "uint256"
                },
                {
                    "name": "team_index",
                    "type": "uint8"
                }
            ],
            "name": "gameWithTeam",
            "outputs": [{
                    "name": "",
                    "type": "uint256"
                },
                {
                    "name": "",
                    "type": "address[]"
                },
                {
                    "name": "",
                    "type": "uint8[]"
                }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": true,
            "inputs": [],
            "name": "owner",
            "outputs": [{
                "name": "",
                "type": "address"
            }],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": false,
            "inputs": [{
                    "name": "_addr",
                    "type": "address"
                },
                {
                    "name": "game_index",
                    "type": "uint256"
                },
                {
                    "name": "item_ind",
                    "type": "uint8"
                }
            ],
            "name": "buyItem",
            "outputs": [],
            "payable": true,
            "stateMutability": "payable",
            "type": "function"
        },
        {
            "constant": true,
            "inputs": [{
                "name": "_addr",
                "type": "address"
            }],
            "name": "getPlayerGame",
            "outputs": [{
                    "name": "",
                    "type": "bool"
                },
                {
                    "name": "",
                    "type": "uint256"
                }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": true,
            "inputs": [],
            "name": "getAllUsers",
            "outputs": [{
                "name": "",
                "type": "address[]"
            }],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        },
        {
            "constant": false,
            "inputs": [{
                "name": "game_id",
                "type": "uint256"
            }],
            "name": "joinGame",
            "outputs": [{
                "name": "",
                "type": "bool"
            }],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "constructor"
        }
    ]


    if (window.dexon && window.dexon.enable) {
        window.dexon.enable().then(e => {
            console.log(e[0]);
            web3 = new Web3(window.dexon);
            console.log(web3);
            //在這裡以下做事才有用ㄚ web3 連到了
            let myContract = new web3.eth.Contract(abi,
                "0xc54cbe5339c7737bb3889f6ae8bc933bc49383f7");
            console.log(myContract);
            myContract.methods.isRegister(window.dexon.defaultAccount).call().then(e => {
                console.log(e);
                if (!e) {
                    location.href = "login.html";
                }
            })
            let p = document.getElementById("ply");
            ply.innerHTML = 'Player:' + e;

            web3.eth.net.getId().then(e => {
                console.log(e);
                //拿 DXN 數量
                web3.eth.getBalance(window.dexon.defaultAccount).then(e => {
                    console.log(e);
                    var balance = web3.utils.fromWei(web3.utils.toBN(e));
                    console.log(balance);
                    let v = document.getElementById("DXNcoin");
                    v.innerHTML = balance;
                    let myContract = new web3.eth.Contract(abi,
                        "0xc54cbe5339c7737bb3889f6ae8bc933bc49383f7");
                    console.log(myContract);
                    //拿菇幣數量
                    myContract.methods.getGuCoin(window.dexon.defaultAccount).call()
                        .then(e => {
                            console.log(e);
                            let k = document.getElementById("Gucoin");
                            k.innerHTML = e;
                        })

                    //點按鈕買菇菇幣
                    document.getElementById("buyGu").onclick = function BuyGu() {
                        myContract.methods.mushroom_eth_rate().call()
                            .then(e => {
                                console.log(e);
                            })
                        const amount = prompt('buy');
                        myContract.methods.buyGuCoin().send({
                            from: window.dexon.defaultAccount,
                            value: web3.utils.toWei(amount),
                        }).then(data => {
                            console.log('event', data);
                            //拿菇幣數量
                            myContract.methods.getGuCoin(window.dexon
                                    .defaultAccount).call()
                                .then(e => {
                                    console.log(e);
                                    let k = document.getElementById("Gucoin");
                                    k.innerHTML = e;
                                })

                            //拿 DXN 數量
                            web3.eth.getBalance(window.dexon.defaultAccount).then(
                                e => {
                                    console.log(e);
                                    var balance = web3.utils.fromWei(web3.utils
                                        .toBN(e));
                                    console.log(balance);
                                    let v = document.getElementById("DXNcoin");
                                    v.innerHTML = balance;

                                })
                        })
                        location.reload();
                    };

                    //判斷進註冊頁還是開局等待頁

                    //在開局的等待頁判斷遊戲是否開始

                    //banker 送錢、開局
                    // document.getElementById("bankerStart").onclick = function () {

                    //     let a = prompt('value');

                    //     myContract.methods.newGame().send({
                    //         from: window.dexon.defaultAccount,
                    //         value: web3.utils.toWei(a)
                    //     }).then(() => {
                    //         //去拿 gameID
                    //         myContract.methods.getPlayerGame(window.dexon
                    //             .defaultAccount).call().then((data) => {
                    //             console.log(data);
                    //             loadingpage();
                    //         })
                    //     })
                    // };

                    //玩家

                })
            })
        })
    }

    function loadingpage() {
        var a = document.getElementById("loadimg");
        a.style.display = "block";
    }

    document.getElementById("bankerStart").onclick = function () {

        setTimeout(function () {
            loadingpage();
        }, 500);

        setTimeout(function () {
            location.href = "bankerView.html";
        }, 5000);

    };


    document.getElementById("playerStart").onclick = function () {
        setTimeout(function () {
            loadingpage();
        }, 500);

        setTimeout(function () {
            location.href = "playerView.html";
        }, 5000);
    };

    function openNav() {
        document.getElementById("mySidenav").style.width = "250px";
    }

    function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
    }
</script>

</html>